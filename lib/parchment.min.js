/*

Parchment
=========

Built: 2011-11-22

Copyright (c) 2008-2011 The Parchment Contributors
BSD licenced
http://code.google.com/p/parchment

*/
(function(){var a=false,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;Object.subClass=function(g){var f=this.prototype,e=f,d,c;a=true;e=new this();a=false;for(d in g){e[d]=typeof g[d]=="function"&&typeof f[d]=="function"&&b.test(g[d])?(function(h,i){return function(){var k=this._super,j;this._super=f[h];j=i.apply(this,arguments);this._super=k;return j}})(d,g[d]):g[d]}c=e.init?function(){if(!a){this.init.apply(this,arguments)}}:function(){};c.prototype=e;c.constructor=c;c.subClass=Object.subClass;return c}})();(function(){function b(h,i){return h[i]<<24|h[i+1]<<16|h[i+2]<<8|h[i+3]}function c(h){return[(h>>24)&255,(h>>16)&255,(h>>8)&255,h&255]}function e(h,i){return String.fromCharCode(h[i],h[i+1],h[i+2],h[i+3])}function g(h){return[h.charCodeAt(0),h.charCodeAt(1),h.charCodeAt(2),h.charCodeAt(3)]}var f=Object.subClass({init:function a(k){this.type="";this.chunks=[];if(k){if(e(k,0)!="FORM"){throw new Error("Not an IFF file")}this.type=e(k,8);var j=12,h=k.length;while(j<h){var m=b(k,j+4);if(m<0||(m+j)>h){throw new Error("IFF: Chunk out of range")}this.chunks.push({type:e(k,j),offset:j,data:k.slice(j+8,j+8+m)});j+=8+m;if(m%2){j++}}}},write:function d(){var m=g(this.type);for(var n=0,j=this.chunks.length;n<j;n++){var k=this.chunks[n],o=k.data,h=o.length;m=m.concat(g(k.type),c(h),o);if(h%2){m.push(0)}}return g("FORM").concat(c(m.length),m)}});f.num_from=b;f.num_to_word=c;f.text_from=e;f.text_to_word=g;window.IFF=f})();(function(j,m,e){var d=m,t=function(B,D){for(var C in D){B[C]=D[C]}return B},c=d.ajaxSetup({cache:1,converters:{"* binary":true}}).isLocal,r={},q=function(D){var C,B=r[D];if(!B){C=d.Callbacks();B=r[D]=C.fire;B.sub=C.add;B.unsub=C.remove}return B},p,g=j.parchment={options:{container:"#parchment",lib_path:"lib/",page_title:1,panels:["search","url","about"],proxy_url:"http://zcode.appspot.com/proxy/"},topic:q,vms:[]};t(g.vms,{add:function(B){this.push(B);this[B.id]=B},match:function(D,B){if(this[D]){return this[D]}for(var C=0;C<this.length;C++){if(this[C].match.test(B)){return this[C]}}}});if(c){m.ajaxPrefilter("script",function(B){B.crossDomain=1})}(function(L,H,C){var P=/inh|tra|(\d+, ?){3}0/,B=H(L),G=H(document),F;H(function(){F=H("body")});t(H.cssHooks,{bgcolor:{get:function(S){var Q=H(S),R=Q.css("background-color");if(P.test(R)){return Q.parent().css("bgcolor")}return R},set:function(S,T){var Q=H(S),R=Q.parent();Q.css("background-color",T);if(P.test(R.css("background-color"))){R.css("bgcolor",T)}}},reverse:{set:function(R,S){if(S){var Q=H(R);Q.css({color:Q.css("bgcolor"),"background-color":Q.css("color")})}}}});var K=L.scrollByPages,E,O=L.getSelection||function(){return document.selection?document.selection.createRange().text:""};if(!K){H(function(){E=parseInt(F.css("line-height"))*2});K=function(R){var Q=document.documentElement.clientHeight,S=Q-Math.min(Q/10,E);scrollBy(0,S*R)}}var I=Object.subClass({init:function(Q){var S=this,R=H("<input>",{"class":"TextInput",autocapitalize:"off",keydown:function(U){var V=S.keyCode=U.which,T;if(S.mode!="line"){return}if(V==38){S.prev_next(1);T=1}if(V==40){S.prev_next(-1);T=1}if(V==33){K(-1);T=1}if(V==34){K(1);T=1}if(V==13){S.submitLine();T=1}if(T){return false}},keypress:function(T){if(S.mode=="char"){S.charCode=T.which;S.submitChar();return false}},keyup:function(){if(S.mode=="char"){S.submitChar()}}});S.lastinput=H('<span class="lastinput"/>').appendTo(Q);G.on("click.TextInput keydown.TextInput",function(T){if(T.target.nodeName!="INPUT"&&O()==""&&B.scrollTop()+B.height()-R.offset().top>-60){T.stopPropagation();L.scrollTo(0,L.scrollMaxY);R.focus().trigger(T)}});S.history=[];S.input=R;S.container=Q;S.statuswin=H("<div>");S.scrollParent=H.browser.webkit?F:H("html");S.msg=g.topic("TextInput")},die:function(){G.off(".TextInput")},getLine:function(R){var T=R.target.children().last(),S=this.input,U=this.scrollParent,Q;this.order=R;this.mode="line";this.current=0;this.mutable_history=this.history.slice();this.mutable_history.unshift("");Q=/^([\s\S]+<br>)(.+?)$/.exec(T.html());if(Q){T.html(Q[1]);Q=T.clone().html(Q[2]).appendTo(T)}else{Q=T}S.width(20).val("").appendTo(Q).width(R.target.offset().left+R.target.width()-S.offset().left);U.scrollTop(this.lastinput.offset().top-this.statuswin.height()-Q.height())},submitLine:function(){var Q=this.input.val();this.lastinput.appendTo(this.input.parent());this.input.detach();if(Q!=this.history[0]&&/\S/.test(Q)){this.history.unshift(Q)}this.msg({mode:"line",input:Q});this.mode=0;this.order.response=Q;this.order.terminator=13;this.callback(this.order)},prev_next:function(U){var Q=this.input,R=this.mutable_history,S=this.current,T=S+U;if(T<R.length&&T>=0){R[S]=Q.val();Q.val(R[T]);this.current=T}},getChar:function(Q){this.order=Q;this.mode="char";this.keyCode=this.charCode=0;this.input.addClass("CharInput").appendTo(this.container)},submitChar:function(){var S=this.keyCode,Q=this.charCode,R={keyCode:S,charCode:Q};if(!S&&!Q){return}this.input.detach().removeClass("CharInput");this.msg({mode:"char",input:R});this.mode=0;this.order.response=R;this.callback(this.order)}});var N=Object.subClass({init:function(R,S){var Q=this;this.elem=R.addClass("TextGrid").on("stream",function(T){Q.stream(T.order.data);return false}).css("bgcolor","inherit");this.lineheight=S.env.charheight;this.io=S;S.TextInput.statuswin=this.elem;this.lines=[];this.styles=[];this.cursor=[0,0]},stream:function(U){var T,Q,W,V,S=this.elem,af=this.cursor[0],R=this.cursor[1],ae=this.lines,ac=this.styles,X=this.io.env,ad,aa,Z,ab,Y=this.lines.length;for(W=0;W<U.length;W++){T=U[W];Q=T.code;if(Q=="height"){while(T.lines>ae.length){ad=[];V=0;while(V++<X.width){ad.push(" ")}ae.push(ad);ac.push(Array(X.width))}if(T.lines<this.lines.length){if(T.lines!=0){Z=H("<div>").addClass("box").prependTo(this.io.target);L.scrollTo(0,L.scrollMaxY);Z.css({top:B.scrollTop()+this.lineheight*T.lines,left:Z.offset().left-1});this.write(Z,ae.slice(T.lines),ac.slice(T.lines))}ae.length=T.lines;ac.length=T.lines;if(af>T.lines-1){af=0;R=0}}}if(Q=="clear"){V=0;while(V<ae.length){Z=0;while(Z<X.width){ae[V][Z++]=" "}ac[V++]=Array(X.width)}af=0;R=0}if(Q=="cursor"){af=T.to[0];R=T.to[1]}if(Q=="get_cursor"){T.pos=[af,R];this.io.input(T)}if(Q=="stream"){ab=H("<tt>").appendTo(S).css(T.css||{}).attr("style");if(ab){ab=' style="'+ab+'"'}aa=T.text;V=0;while(V<aa.length){Z=aa.charAt(V++);if(Z!="\n"){ae[af][R]=Z;ac[af][R++]=ab}if(Z=="\n"||R==X.width){af++;R=0}}}if(Q=="eraseline"){for(V=R;V<X.width;V++){ae[af][V]=" ";ac[af][V]=C}}}this.cursor=[af,R];this.write(S,ae,ac);if(ae.length!=Y){H(".main").css("padding-top",S.height())}},write:function(W,R,V){var Q="",T=0,S,X,U;while(T<R.length){X="";U=V[T][0];for(S=0;S<R[T].length;S++){if(V[T][S]==U){X+=R[T][S]}else{Q+="<tt"+(U||"")+">"+X+"</tt>";U=V[T][S];X=R[T][S]}}Q+="<tt"+(U||"")+">"+X+"</tt>";if(++T<R.length){Q+="<br>"}}W.html(Q)}});var J=function(Q){return"\n"+Array(Q.length).join("&ensp;")},M=function(U){var Q=U.order,T=U.io.structures[Q.name]||{node:"span"},S=Q.node||T.node,V=Q.text,R=H("<"+S+">").appendTo(U.target).addClass(Q.name).css(Q.css||{});if(V){if(S!="tt"){V=V.replace(/\n +(?=\S)/g,J)}R.html(V.replace(/\n/g,"<br>"))}if(T.func){T.func(R,U.io)}return false},D=Object.subClass({init:function(T){T=t({},T);this.env=T;var R=this.container=this.target=H(T.container),Q=H("<tt>00000</tt>").appendTo(R),V=Q.height(),S=Q.width()/5,U=Math.min(Math.floor(R.width()/S),T.width||80);Q.remove();t(T,{charheight:V,charwidth:S,width:U});R.on("stream",M).width(U*S);this.TextInput=new I(R);this.structures={main:{node:"div"},status:{node:"div",func:function(W,X){new N(W,X)}}}},event:function(T){var Q,U,S,V=this.target,R;for(S=0;S<T.length;S++){Q=T[S];U=Q.code;if(U=="structures"){Q.code=C;H.extend(this.structures,Q)}if(U=="find"){this.target=V=H("."+Q.name)}if(U=="stream"){(Q.to?H("."+Q.to):V).trigger({type:"stream",io:this,order:Q})}if(U=="clear"){R=Q.name?H("."+Q.name):V;R.empty();if(Q.css&&Q.css["background-color"]){(Q.name=="main"?R:F).css("background-color",Q.css["background-color"])}}if(U=="read"){Q.target=V;this.TextInput.getLine(Q)}if(U=="char"){this.TextInput.getChar(Q)}}}});L.StructIO=D;D.TextInput=I})(j,m);var f=Object.subClass({init:function(D,C){var B=this;C=j.engine=this.e=new j[C]();this.io=new StructIO(D);this.toEngine=this.io.TextInput.callback=function(E){C.inputEvent(E)};C.outputEvent=function(E){B.fromEngine(E)}},fromParchment:function(C){var B=C.code;if(B=="load"){C.env=this.io.env}this.toEngine(C)},fromEngine:function(F){var E=this.e,D=0,B,G,C;this.io.event(F);for(;D<F.length;D++){B=F[D];G=B.code;if(G=="quit"){return}if(G=="save"||G=="restore"){this.toParchment(B)}if(G=="restart"){this.io.target=this.io.container.empty();C=1}if(G=="tick"){C=1}}if(C){this.toEngine(B)}}});(function(B){j.FatalError=function(C){this.message=C;this.traceback=this._makeTraceback(arguments.callee);this.onError(this);if(B(".load").length>0){B(".load").detach()}};FatalError.prototype={onError:function(D){var C=D.message;B("#parchment").append('<div class="error">An error occurred:<br/><pre>'+C+"\n\n"+D.traceback+"</pre></div>");if(j.console){console.error(C)}},_makeTraceback:function(C){var F="";var E=0;var D=100;while(C!=null&&E<D){var G=C.toString();if(!G){F="\n  (anonymous function)"+F}else{var H=G.match(/function (\w*)/);if(!H||!H[1]){F="\n  (anonymous function)"+F}else{F="\n  "+H[1]+F}}try{C=C.caller}catch(I){C=null}E++}if(E==D){F="..."+F}return"Traceback (most recent call last):\n"+F}}})(m);var v=(function(E,G){var I={},B=JSON?JSON.parse:G.parseJSON,C=E.localStorage,F,D,H=function(){if(C){F=!c||!G.browser.mozilla}else{C={}}t(I,{persist:F,get:function(J,K){return B(C[J])},set:function(J,K){C[J]=JSON.stringify(K)}})};H();return I})(this,m);var l=Object.subClass({init:function(D){t(this,D);var C=this._has,B;if(C){for(B in C){this[B]=new z(l.models[B],this);this[B].fetch(C[B])}}this._id=this._id||this._id_prop&&this[this._id_prop]||l.id++},save:function(B){var F={},E,C=this._has,D={},G;for(E in this){if(this[E]&&E.charAt(0)!="_"&&!l.models[E]&&typeof this[E]!="function"){F[E]=this[E]}}if(C){for(E in C){if(this[E].length){D[E]=this[E].save(B);G=1}}F._has=G&&D}v.set(this._Class+this._id,F)},set:function(C,B){this[C]=B;this.save()},data:function(B){var C="DATA"+this._Class+this._id;if(B){v.set(C,B)}else{B=this._data||v.get(C)}return this._data=B}}),z=Object.subClass.call(Array,{init:function(B,C){this.Class=B;this._parent=C},fetch:function(B){var E,D,C=this.length=0;B=B||v.get("INDEX"+this.Class.Class);if(B){while(C<B.length){E=B[C++];D=v.get(this.Class.Class+E);if(D){D._id=E;this.add(new this.Class(D))}}}},save:function(B){var E=[],C=0,D;while(C<this.length){D=this[C++];E.push(D._id);if(B){D.save()}}if(this._parent){return E}v.set("INDEX"+this.Class.Class,E)},add:function(B){this.push(B);B._parent=this;B.save();(this._parent||this).save()},find:function(G,E){var F=new z(this.Class,this._parent),D,C,B=0;while(B<this.length){C=this[B++];if(C[G]==E){F.push(C)}}return F}});t(l,{subClass:function(B,C){C=C||{};C._Class=B;var D=Object.subClass.call(this,C);t(D,{Class:B,subClass:l.subClass});l.models[B]=D;return D},models:{},id:(new Date()).getTime(),});var x=(function(H,F){if(H.execScript){execScript("Function VBCStr(x)\nVBCStr=CStr(x)\nEnd Function\nFunction VBLastAsc(x)\nDim l\nl=LenB(x)\nIf l mod 2 Then\nVBLastAsc=AscB(MidB(x,l,1))\nElse\nVBLastAsc=-1\nEnd If\nEnd Function","VBScript")}var G=/chrome\/(\d+)/i.exec(navigator.userAgent),E=G&&parseInt(G[1])>4,B=function(R,S){var S=S||[],Q=0,P;for(P=R.length%8;Q<P;++Q){S.push(R.charCodeAt(Q)&255)}for(P=R.length;Q<P;){S.push(R.charCodeAt(Q++)&255,R.charCodeAt(Q++)&255,R.charCodeAt(Q++)&255,R.charCodeAt(Q++)&255,R.charCodeAt(Q++)&255,R.charCodeAt(Q++)&255,R.charCodeAt(Q++)&255,R.charCodeAt(Q++)&255)}return S},M=function(Q,P){return(P||"")+String.fromCharCode.apply(1,Q)},I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",D=(function(){var P=[],Q=0;for(;Q<I.length;Q++){P[I.charAt(Q)]=Q}return P})(),C=function(U,S){if(H.atob){return B(atob(U),S)}var S=S||[],V,R,Q,Z,Y,X,W,T=0,P=U.length;while(T<P){Z=D[U.charAt(T++)];Y=D[U.charAt(T++)];X=D[U.charAt(T++)];W=D[U.charAt(T++)];V=(Z<<2)+(Y>>4);R=((Y&15)<<4)+(X>>2);Q=((X&3)<<6)+W;S.push(V,R,Q)}if(W==64){S.pop()}if(X==64){S.pop()}return S},J=function(U,S){if(H.btoa){return btoa(M(U,S))}var S=S||"",V,R,Q,Z,Y,X,W,T=0,P=U.length;while(T<P){V=U[T++];R=U[T++];Q=U[T++];Z=V>>2;Y=((V&3)<<4)+(R>>4);X=((R&15)<<2)+(Q>>6);W=Q&63;S+=(I.charAt(Z)+I.charAt(Y)+I.charAt(X)+I.charAt(W))}if(isNaN(R)){S=S.slice(0,-2)+"=="}else{if(isNaN(Q)){S=S.slice(0,-1)+"="}}return S},K=function(U){var V=VBCStr(U),T=VBLastAsc(U),P=[],R=0,Q=V.length%4,S;while(R<Q){P.push((S=V.charCodeAt(R++))&255,S>>8)}Q=V.length;while(R<Q){P.push((S=V.charCodeAt(R++))&255,S>>8,(S=V.charCodeAt(R++))&255,S>>8,(S=V.charCodeAt(R++))&255,S>>8,(S=V.charCodeAt(R++))&255,S>>8)}if(T>-1){P.push(T)}return P},N=m.ajaxSettings.xhr(),L={binary:N.overrideMimeType&&!(F.browser.opera&&parseFloat(F.browser.version)<10.5)?"charset":"responseBody" in N?"responseBody":0},O=function(R,U,Q){var T,P,S;R=F.trim(R);if(Q.mode=="base64"){if(H.atob){S=atob(R);T=B(S)}else{T=C(R)}}else{if(Q.mode=="charset"){T=B(R)}else{T=K(Q.xhr.responseBody)}}Q.responseArray=T;Q.responseText=S};N=e;F.ajaxPrefilter("binary",function(Q,T,R){var S=c&&!Q.crossDomain&&E?0:L.binary,P=Q.xhr;Q.xhr=function(){return R.xhr=P.apply(Q)};Q.binary=S;R.done(O);Q.jsonp=false;Q.jsonpCallback="processBase64Zcode";R.mode="base64";if(Q.url.slice(-3).toLowerCase()==".js"){return"jsonp"}if(S&&!Q.crossDomain){return"text"}if(Q.legacy){Q.url=Q.legacy;return"jsonp"}Q.data="url="+Q.url;Q.url=g.options.proxy_url;if(S&&F.support.cors){return"text"}Q.data+="&encode=base64&callback=pproxy";Q.jsonpCallback="pproxy";return"jsonp"});F.ajaxPrefilter("text",function(P,R,Q){Q.mode=P.binary;if(Q.mode=="charset"){P.mimeType="text/plain; charset=x-user-defined"}});return g.file={text_to_array:B,array_to_text:M,base64_decode:C,base64_encode:J,support:L}})(j,m);var u='<p><a href="'+location.href+"?story=http://mirror.ifarchive.org/",a=function(B){return u+B.path+'">'+B.desc.entityify()+"</a></p>"},i=Object.subClass({init:function(B){this.library=B;this.panels={};this.load_indicator=d('<div class="dialog load"><p>Parchment is loading.<p>&gt; <blink>_</blink></div>')},stylesheet_add:function(){var B=arguments,C;for(C=1;C<B.length;C++){if(document.createStyleSheet){document.createStyleSheet(B[C])}else{d("<link>",{rel:"alternate stylesheet",href:B[C],title:B[0],type:"text/css"}).appendTo("head")[0].disabled=true}}},stylesheet_switch:function(C,B){d('link[rel*="stylesheet"][title="'+C+'"]').each(function(){this.disabled=!B})},load_panels:function(){var B=g.options.panels,F,E,D,C=function(){var H=RegExp(E.val().replace(" ","( )?"),"i"),G=d.grep(F,function(I){return H.test(I.path+I.desc)});G=G.slice(0,30);D.html(d.map(G,a).join(""))};if(d.inArray("search",B)!=-1){this.panels.search=d('<div class="panel search"><label for="panel_search">Search the IF Archive for games you can play with Parchment. You might also like to search the <a href="http://ifdb.tads.org">IFDB</a> or the <a href="http://ifwiki.org">IF Wiki</a>.</label><input id="panel_search"><div></div></div>');E=this.panels.search.find("input");D=E.next();E.keydown(function(){E.unbind("keydown");d.getJSON("stories/if-archive.json").done(function(G){F=G;E.keyup(C);C()})})}if(d.inArray("url",B)!=-1){this.panels.url=d('<form class="panel url"><label for="panel_url">You may use Parchment to play any story file on the internet, simply copy its address here:</label><input id="panel_url" name="story"></form>')}this.library.container.append(this.panels[B[0]]);this.panels.active=B[0]}});var A=/([-\w\s_]+)(\.[\w]+(\.js)?)?$/,o=/\.js$/,h=l.subClass("Savefile",{}),b=l.subClass("Story",{_has:{Savefile:[]},_id_prop:"url",launch:function(E){E=g.vms.match(E||this.vm,this.url);if(!E){throw new FatalError("File type is not supported!")}var F=[d.ajax(this.url,{dataType:"binary",legacy:this.backup}).done(function(H,I,G){G.library=p;G.vm=E}).fail(k)],B=[],D=0,C;if(!E.loaded){E.loaded=1;while(D<E.files.length){C=g.options.lib_path+E.files[D++];if(o.test(C)){B.push(d.getScript(C))}else{this.ui.stylesheet_add(E.id,C)}}F[1]=d.when.apply(1,B)}d.when.apply(1,F).done(n)}}),k=function(){throw new FatalError("Parchment could not load the story. Check your connection, and that the URL is correct.")},n=function(C){d(".load").detach();var D=g.runner=new (j[C[2].vm.runner]||f)(g.options,C[2].vm.engine),B=location.hash;D.toParchment=function(E){C[2].library.fromRunner(D,E)};D.fromParchment({code:"load",data:(new y(C[2].responseArray)).data});if(B&&B!="#"){D.fromParchment({code:"restore",data:x.base64_decode(B.slice(1))})}else{D.fromParchment({code:"restart"})}},y=IFF.subClass({init:function w(G,C){this.title=C;if(G[0]<9){this._super();this.chunks.push({type:"ZCOD",data:G});this.data=G}else{if(IFF.text_from(G,0)=="Glul"){this._super();this.chunks.push({type:"GLUL",data:G});this.data=G}else{if(IFF.text_from(G,0)=="FORM"){this._super(G);if(this.type=="IFRS"){for(var E=0,B=this.chunks.length;E<B;E++){var F=this.chunks[E].type;if(F=="ZCOD"&&!this.zcode){this.data=this.chunks[E].data}else{if(F=="GLUL"&&!this.glulx){this.data=this.chunks[E].data}else{if(F=="IFmd"){this.metadata=x.array_to_text(this.chunks[E].data);var D=d(this.metadata);if(D){if(d("title",D)){this.title=d("title",D).text()}if(d("ifid",D)){this.ifid=d("ifid",D).text()}if(d("release",D)){this.release=d("release",D).text()}}}}}}}}}}}}),s=z.subClass({init:function(){this.Class=b;this.fetch();this.container=d(g.options.container);this.ui=new i(this)},load:function(G){var B=this,C=g.options,E=/vm=(\w+)/.exec(location.search),D=this.get_story();if(!D){return this.ui.load_panels()}d("#about").remove();d("body").append(B.ui.load_indicator);if(E){D.set("vm",(E=E[1]))}try{D.launch(E)}catch(F){throw new FatalError(F)}},get_story:function(){var C=g.options,E=/story=([^;&]+)/.exec(location.search),B,D;if(C.lock_story){E=C.default_story;if(!E){throw"Story file not specified"}}else{if(C.default_story||E){E=E&&unescape(E[1])||C.default_story}else{return}}if(d.isArray(E)){B=E[1];E=E[0]}D=this.find("url",E)[0];if(!D){this.add(D=new b({url:E,backup:B}))}return D},fromRunner:function(E,D){var C=D.code,B=location.hash;if(C=="save"){location.hash=x.base64_encode(D.data)}if(C=="restore"){if(B&&B!="#"){D.data=x.base64_decode(B.slice(1))}}E.fromParchment(D)}});g.vms.add({id:"quixe",match:/(ulx|glb|(g|glulx.+)(blorb|blb))(.js)?$/i,files:["prototype.min.js","glkote.min.js","quixe.min.js","glkote.min.css"],runner:"QuixeRunner"});g.vms.add({id:"zvm",match:/(z[58]|zlb|(z|zcode.+)(blorb|blb))(.js)?$/i,files:["zvm.min.js"],engine:"ZVM"});g.vms.add({id:"gnusto",match:/(z[1-8]|zlb|(z|zcode.+)(blorb|blb))(.js)?$/i,files:["gnusto.min.js"],runner:"GnustoRunner"});d(function(){var B=/options=([^;&]+)/.exec(location.search);if(j.parchment_options){d.extend(g.options,parchment_options)}if(!g.options.lock_options&&B){d.extend(g.options,d.parseJSON(unescape(B[1])))}p=g.library=new s();p.load();if(location.href.indexOf("iplayif.com")!=-1){d.getScript("http://google-analytics.com/ga.js",function(){_gat._getTracker("UA-7949545-3")._trackPageview()})}})})(this,jQuery);